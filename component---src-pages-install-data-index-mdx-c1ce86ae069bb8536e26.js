(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{xd46:function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",(function(){return c})),t.d(n,"default",(function(){return u}));var o,a=t("k1TG"),s=t("8o2o"),r=(t("q1tI"),t("7ljp")),i=t("013z"),c=(t("T0C+"),t("qKvR"),{}),l=(o="PageDescription",function(e){return console.warn("Component "+o+" was not imported, exported, or provided by MDXProvider as global scope"),Object(r.b)("div",e)}),p={_frontmatter:c},m=i.a;function u(e){var n=e.components,t=Object(s.a)(e,["components"]);return Object(r.b)(m,Object(a.a)({},p,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)(l,{mdxType:"PageDescription"}),Object(r.b)("h2",null,"Install Cloud Pak for Data 3.0.1 on IBM Managed Openshift 4.3 (ROKS)"),Object(r.b)("h3",null,"Sizing Openshift Cluster for Cloud Pak for Data 3.0.1"),Object(r.b)("p",null,"Sizing Worker Nodes based on Services that are to be installed. Refer : ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://salesconfig.ibmcloudpack.com/sales/#/zen/configure"}),"https://salesconfig.ibmcloudpack.com/sales/#/zen/configure"),"\nTo do the sizing"),Object(r.b)("p",null,"Please note that if you want to install Watson AI services (Watson Assistant, Watson Discovery, Watson AIOps, Watson Language Translator, Watson Speech to Text, Watson Text to Speech) size them separately as they will need bare metal worker nodes and will not work on virtual server worker nodes."),Object(r.b)("h3",null,"Provision Openshift 4.3 Cluster on IBM Cloud"),Object(r.b)("p",null,Object(r.b)("strong",{parentName:"p"},"Note:")," Make sure you have Administrator and Manager lever permission on the account where you are provisioning the cluster."),Object(r.b)("p",null,"Provision Openshift 4.3 Cluster from IBM Cloud console. Select Virtual Server Worker nodes based on the above sizing calculations. If you are installing Watson AI services, we will add Bare metal worker nodes post the cluster creation."),Object(r.b)("p",null,"Once the cluster is created, create a new worker pool which will have bare metal servers required for Watson AI Services installation."),Object(r.b)("p",null,"Once the cluster is ready, launch its console and on the right top corner, from copy login command, get the token to login to Openshift cluster remotely using cli"),Object(r.b)("p",null,"Make sure you have a system with Openshift and IBM Cloud cli installed.\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://cloud.ibm.com/docs/openshift?topic=openshift-openshift-cli#cli_oc"}),"https://cloud.ibm.com/docs/openshift?topic=openshift-openshift-cli#cli_oc"),"\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://cloud.ibm.com/docs/cli/reference/bluemix_cli/download_cli.html"}),"https://cloud.ibm.com/docs/cli/reference/bluemix_cli/download_cli.html")),Object(r.b)("p",null,"Execute oc login command obtained in above step from Openshift Web Console"),Object(r.b)("h3",null,"Setting up Openshift Cluster for Cloud Pak for Data Installation"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Create an external route of Openshift Image registry.\nUse token obtained in abive step to login from a system to OpenShift Cluster and run below commands to create an external route")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"oc create route reencrypt --service=image-registry -n openshift-image-registry\noc annotate route image-registry --overwrite haproxy.router.openshift.io/balance=source -n openshift-image-registry\n")),Object(r.b)("ol",{start:2},Object(r.b)("li",{parentName:"ol"},"Resize image registry storage volume\nDefault size of Openshift image registry will not be sufficient to load images if you are going to install multiple Services on Cloud Pak for Data. Hence it needs to be resized to 200GB. Run below commands to do it.")),Object(r.b)("p",null,"ibmcloud login (login into Account where your Openshift Cluster is setup)"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"registry_pv=`oc get pvc -n openshift-image-registry | grep \"image-registry-storage\" | awk '{print $3}'`\nvolid=`oc describe pv $registry_pv -n openshift-image-registry | grep volumeId`\nIFS='='\nread -ra vol <<< \"$volid\"\nvolume=${vol[1]}\necho volume id is $volume\nibmcloud sl file volume-modify $volume --new-size 200 --new-tier 10 â€“force\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"Set kernel parameters (",Object(r.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.ibm.com/support/knowledgecenter/SSQNUZ_3.0.1/cpd/install/node-settings.html"}),"https://www.ibm.com/support/knowledgecenter/SSQNUZ_3.0.1/cpd/install/node-settings.html"),")\nSince we do not have ssh access to worker nodes on ROKS, we will use daemonset to perform kernel parameter settings. Create setkernelparameters.yaml file with below contents")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-apiVersion:",metastring:"tuned.openshift.io/v1","tuned.openshift.io/v1":!0}),"kind: Tuned\nmetadata:\n  name: cp4d-wkc-ipc\n  namespace: openshift-cluster-node-tuning-operator\nspec:\n  profile:\n  - name: cp4d-wkc-ipc\n    data: |\n      [main]\n      summary=Tune IPC Kernel parameters on OpenShift Worker Nodes running WKC Pods\n      [sysctl]\n      kernel.shmall = 33554432\n      kernel.shmmax = 68719476736\n      kernel.shmmni = 16384\n      kernel.sem = 250 1024000 100 16384\n      kernel.msgmax = 65536\n      kernel.msgmnb = 65536\n      kernel.msgmni = 32768\n      vm.max_map_count = 262144\n  recommend:\n  - match:\n    - label: node-role.kubernetes.io/worker\n    priority: 10\n    profile: cp4d-wkc-ipc\n")),Object(r.b)("p",null,"Run below commands to do the changes"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"oc project kube-system\noc create -f setkernelparameters.yaml\n")),Object(r.b)("ol",{start:4},Object(r.b)("li",{parentName:"ol"},"Change NFS mount settings\nIf you are using IBM Cloud File Storage for PVC creation, we need to make sure pvcs are mounted with root permissions. ")),Object(r.b)("p",null,"a.\tCreate a service account called norootsquash by running the following command:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"oc create -f - << EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: norootsquash\n  namespace: kube-system\nEOF\n")),Object(r.b)("p",null,"b.\tGive the service account privileged security context constraints (SCC) by running the following command:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),"oc adm policy add-scc-to-user privileged system:serviceaccount:kube-system:norootsquash\n")),Object(r.b)("p",null,"c.\tCreate the daemonset by running the following command:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{}),'oc create -f - << EOF\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: norootsquash\n  namespace: kube-system\n  labels:\n    tier: management\n    app: norootsquash\nspec:\n  selector:\n    matchLabels:\n      name: norootsquash\n  template:\n    metadata:\n      labels:\n        name: norootsquash\n    spec:\n      serviceAccountName: norootsquash\n      initContainers:\n        - resources:\n            requests:\n              cpu: 0.1\n          securityContext:\n            privileged: true\n          image: alpine:3.6\n          name: unrootsquash\n          command: ["chroot", "/host", "sh", "-c"]\n          args:\n            - >\n              grep "^Domain = slnfsv4.com" /etc/idmapd.conf;\n              if [ "\\$?" -ne "0" ] ; then\n                sed -i \'s/.*Domain =.*/Domain = slnfsv4.com/g\' /etc/idmapd.conf;\n                nfsidmap -c;\n                rpc.idmapd\n              fi;\n          volumeMounts:\n            - name: host\n              mountPath: /host\n      containers:\n        - resources:\n            requests:\n              cpu: 0.1\n          image: alpine:3.6\n          name: sleep\n          command: ["/bin/sh", "-c"]\n          args:\n            - >\n              while true; do\n                sleep 100000;\n              done\n      volumes:\n        - hostPath:\n            path: /\n            type: Directory\n          name: host\nEOF\n')),Object(r.b)("h3",null,"Setting Portworx Storage"),Object(r.b)("p",null,"Watson AI services (Watson Assistant, Watson Discovery, Watson Knowledge Studio, Watson Speech to Text and Watson text to Speech) install is currently supported only with Enterprise Portworx storage. Follow the steps mentioned below to set that up for ROKS. Make sure you are logged in to IBM Cloud and Openshift using CLI (ibmcloud and oc)"))}u.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-install-data-index-mdx-c1ce86ae069bb8536e26.js.map