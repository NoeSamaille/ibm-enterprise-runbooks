{"componentChunkName":"component---src-pages-ibmcloud-openvpn-vsi-vpc-index-mdx","path":"/ibmcloud/openvpn-vsi-vpc/","result":{"pageContext":{"frontmatter":{"title":"Use OpenVPN to access virtual server instances running in a virtual private cloud"},"relativePagePath":"/ibmcloud/openvpn-vsi-vpc/index.mdx","titleType":"page","MdxNode":{"id":"17c2bbb3-e9ac-517b-b4ea-238e9e1d1a24","children":[],"parent":"8bafab21-2a85-53aa-a27c-1feb42715895","internal":{"content":"---\ntitle: Use OpenVPN to access virtual server instances running in a virtual private cloud\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\n\n</PageDescription>\n\n## **Use OpenVPN to access virtual server instances running in a virtual private cloud**\n\nVirtual Private Cloud (VPC) come with an additional layer of security as your workload can be completely hidden from the public Internet. But there are times when you will want to get into this private network. A common practice is to use a bastion host to jump into your VPC from your local machine as example. Another option is to install a VPN software inside your VPC to extend the secure VPC network to your local network.\n\nOpenVPN is a popular VPN software solution that can be easily installed on a server and offer a simple way to reach all the servers in your VPC from your local machine.\n\nThis repo shows how to deploy OpenVPN inside a VPC using Terraform and Ansible.\n\n![openvpn.png](vpc-vsi.png) \n \n### **Deploy all resources**\n\n1. Copy `terraform.tfvars.template` to `terraform.tfvars`:\n```sh\n   cp terraform.tfvars.template terraform.tfvars\n```\n2. Edit `terraform.tfvars` to match your environment.\n\n3. Use the [following Docker image](https://github.com/l2fprod/ibmcloud-ci) to run the deployment scripts. It has all required tools preinstalled.\n\n* On Linux terminal:\n```\n   docker run -it --volume $PWD:/root/mnt/home --workdir /root/mnt/home l2fprod/ibmcloud-ci\n```\n\n* On Windows command prompt:\n```\n   docker run -it --volume %CD%:/root/mnt/home --workdir /root/mnt/home l2fprod/ibmcloud-ci\n```\n\nYou can also try with your own environment. Prereqs are: tfswitch, terraform, ansible, ssh.\n\n4. Run `tfswitch` to point to the right Terraform version for this solution:\n```\n   tfswitch\n```\n\n5. Deploy all resources:\n\n```sh\n   terraform init\n   terraform apply\n```\n\n### **Install OpenVPN on the bastion**\n\n1. Change to ansible directory:\n\n```\n   cd ansible\n```\n\n2. Install ansible dependencies\n```\n   ansible-galaxy install -r requirements.yml\n```\n\n3. To confirm ansible configuration, ping all hosts\n```\n   ansible all -m ping -i inventory -v\n```\n\n4. Install OpenVPN on the bastion\n```\n   ansible-playbook -i inventory playbook-openvpn.yml\n```\n\n### **Connect to OpenVPN**\n\nTo connect to the VPN, use _OpenVPN Connects_ with the configuration generated in `ansible/client-config/mymachine`:\n- https://openvpn.net/client-connect-vpn-for-windows/\n- https://openvpn.net/client-connect-vpn-for-mac-os/\n\nor from a command line\n```\n   openvpn --setenv FORWARD_COMPATIBLE 1 --daemon --config ./client-config/mymachine/*-bastion.ovpn\n```\n\nTo view routes on macOS, use `netstat -nr`. On Linux and Windows `netstat -ar`.\n\n### **Test the OpenVPN connection**\n\nFrom the Docker container, ping one VPC server instance directly from your local machine:\n```\n   ping $(terraform output -json | jq -r '.instance_ips.value[0]')\n```\n\nor a COS direct endpoint:\n```\n   ping s3.direct.us.cloud-object-storage.appdomain.cloud\n```\n\nor a service private endpoint:\n```\n   ping api.private.us-south.speech-to-text.watson.cloud.ibm.com\n```\n\nIf you stop the VPN connection, all these ping would fail.\n\n### **Destroy all configuration**\n\n1. To destroy the environment, from the Docker container use:\n```sh\n   terraform destroy\n```\n","type":"Mdx","contentDigest":"83b2d913fab8343e3eb2c69bb8fb15f6","counter":713,"owner":"gatsby-plugin-mdx"},"frontmatter":{"title":"Use OpenVPN to access virtual server instances running in a virtual private cloud"},"exports":{},"rawBody":"---\ntitle: Use OpenVPN to access virtual server instances running in a virtual private cloud\n---\n\nimport Globals from 'gatsby-theme-carbon/src/templates/Globals';\n\n<PageDescription>\n\n\n</PageDescription>\n\n## **Use OpenVPN to access virtual server instances running in a virtual private cloud**\n\nVirtual Private Cloud (VPC) come with an additional layer of security as your workload can be completely hidden from the public Internet. But there are times when you will want to get into this private network. A common practice is to use a bastion host to jump into your VPC from your local machine as example. Another option is to install a VPN software inside your VPC to extend the secure VPC network to your local network.\n\nOpenVPN is a popular VPN software solution that can be easily installed on a server and offer a simple way to reach all the servers in your VPC from your local machine.\n\nThis repo shows how to deploy OpenVPN inside a VPC using Terraform and Ansible.\n\n![openvpn.png](vpc-vsi.png) \n \n### **Deploy all resources**\n\n1. Copy `terraform.tfvars.template` to `terraform.tfvars`:\n```sh\n   cp terraform.tfvars.template terraform.tfvars\n```\n2. Edit `terraform.tfvars` to match your environment.\n\n3. Use the [following Docker image](https://github.com/l2fprod/ibmcloud-ci) to run the deployment scripts. It has all required tools preinstalled.\n\n* On Linux terminal:\n```\n   docker run -it --volume $PWD:/root/mnt/home --workdir /root/mnt/home l2fprod/ibmcloud-ci\n```\n\n* On Windows command prompt:\n```\n   docker run -it --volume %CD%:/root/mnt/home --workdir /root/mnt/home l2fprod/ibmcloud-ci\n```\n\nYou can also try with your own environment. Prereqs are: tfswitch, terraform, ansible, ssh.\n\n4. Run `tfswitch` to point to the right Terraform version for this solution:\n```\n   tfswitch\n```\n\n5. Deploy all resources:\n\n```sh\n   terraform init\n   terraform apply\n```\n\n### **Install OpenVPN on the bastion**\n\n1. Change to ansible directory:\n\n```\n   cd ansible\n```\n\n2. Install ansible dependencies\n```\n   ansible-galaxy install -r requirements.yml\n```\n\n3. To confirm ansible configuration, ping all hosts\n```\n   ansible all -m ping -i inventory -v\n```\n\n4. Install OpenVPN on the bastion\n```\n   ansible-playbook -i inventory playbook-openvpn.yml\n```\n\n### **Connect to OpenVPN**\n\nTo connect to the VPN, use _OpenVPN Connects_ with the configuration generated in `ansible/client-config/mymachine`:\n- https://openvpn.net/client-connect-vpn-for-windows/\n- https://openvpn.net/client-connect-vpn-for-mac-os/\n\nor from a command line\n```\n   openvpn --setenv FORWARD_COMPATIBLE 1 --daemon --config ./client-config/mymachine/*-bastion.ovpn\n```\n\nTo view routes on macOS, use `netstat -nr`. On Linux and Windows `netstat -ar`.\n\n### **Test the OpenVPN connection**\n\nFrom the Docker container, ping one VPC server instance directly from your local machine:\n```\n   ping $(terraform output -json | jq -r '.instance_ips.value[0]')\n```\n\nor a COS direct endpoint:\n```\n   ping s3.direct.us.cloud-object-storage.appdomain.cloud\n```\n\nor a service private endpoint:\n```\n   ping api.private.us-south.speech-to-text.watson.cloud.ibm.com\n```\n\nIf you stop the VPN connection, all these ping would fail.\n\n### **Destroy all configuration**\n\n1. To destroy the environment, from the Docker container use:\n```sh\n   terraform destroy\n```\n","fileAbsolutePath":"/home/runner/work/ibm-enterprise-runbooks/ibm-enterprise-runbooks/src/pages/ibmcloud/openvpn-vsi-vpc/index.mdx"}}},"staticQueryHashes":["1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","2982904675","3018647132","3018647132","3037994772","3037994772","63531786","63531786","768070550"]}